6c122f3557a3c64f95024d902af8fea6
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('@angular/router');
const testing_1 = require("@angular/core/testing");
const http_1 = require("@angular/common/http");
const testing_2 = require("@angular/common/http/testing");
const forms_1 = require("@angular/forms");
const router_1 = require("@angular/router");
const rxjs_1 = require("rxjs");
const forms_service_1 = require("../service/forms.service");
const forms_model_1 = require("../forms.model");
const user_service_1 = require("app/entities/user/user.service");
const forms_update_component_1 = require("./forms-update.component");
describe('Component Tests', () => {
    describe('Forms Management Update Component', () => {
        let comp;
        let fixture;
        let activatedRoute;
        let formsService;
        let userService;
        beforeEach(() => {
            testing_1.TestBed.configureTestingModule({
                imports: [testing_2.HttpClientTestingModule],
                declarations: [forms_update_component_1.FormsUpdateComponent],
                providers: [forms_1.FormBuilder, router_1.ActivatedRoute],
            })
                .overrideTemplate(forms_update_component_1.FormsUpdateComponent, '')
                .compileComponents();
            fixture = testing_1.TestBed.createComponent(forms_update_component_1.FormsUpdateComponent);
            activatedRoute = testing_1.TestBed.inject(router_1.ActivatedRoute);
            formsService = testing_1.TestBed.inject(forms_service_1.FormsService);
            userService = testing_1.TestBed.inject(user_service_1.UserService);
            comp = fixture.componentInstance;
        });
        describe('ngOnInit', () => {
            it('Should call User query and add missing value', () => {
                const forms = { id: 456 };
                const user = { id: 73914 };
                forms.user = user;
                const userCollection = [{ id: 84933 }];
                spyOn(userService, 'query').and.returnValue(rxjs_1.of(new http_1.HttpResponse({ body: userCollection })));
                const additionalUsers = [user];
                const expectedCollection = [...additionalUsers, ...userCollection];
                spyOn(userService, 'addUserToCollectionIfMissing').and.returnValue(expectedCollection);
                activatedRoute.data = rxjs_1.of({ forms });
                comp.ngOnInit();
                expect(userService.query).toHaveBeenCalled();
                expect(userService.addUserToCollectionIfMissing).toHaveBeenCalledWith(userCollection, ...additionalUsers);
                expect(comp.usersSharedCollection).toEqual(expectedCollection);
            });
            it('Should update editForm', () => {
                const forms = { id: 456 };
                const user = { id: 15812 };
                forms.user = user;
                activatedRoute.data = rxjs_1.of({ forms });
                comp.ngOnInit();
                expect(comp.editForm.value).toEqual(expect.objectContaining(forms));
                expect(comp.usersSharedCollection).toContain(user);
            });
        });
        describe('save', () => {
            it('Should call update service on save for existing entity', () => {
                // GIVEN
                const saveSubject = new rxjs_1.Subject();
                const forms = { id: 123 };
                spyOn(formsService, 'update').and.returnValue(saveSubject);
                spyOn(comp, 'previousState');
                activatedRoute.data = rxjs_1.of({ forms });
                comp.ngOnInit();
                // WHEN
                comp.save();
                expect(comp.isSaving).toEqual(true);
                saveSubject.next(new http_1.HttpResponse({ body: forms }));
                saveSubject.complete();
                // THEN
                expect(comp.previousState).toHaveBeenCalled();
                expect(formsService.update).toHaveBeenCalledWith(forms);
                expect(comp.isSaving).toEqual(false);
            });
            it('Should call create service on save for new entity', () => {
                // GIVEN
                const saveSubject = new rxjs_1.Subject();
                const forms = new forms_model_1.Forms();
                spyOn(formsService, 'create').and.returnValue(saveSubject);
                spyOn(comp, 'previousState');
                activatedRoute.data = rxjs_1.of({ forms });
                comp.ngOnInit();
                // WHEN
                comp.save();
                expect(comp.isSaving).toEqual(true);
                saveSubject.next(new http_1.HttpResponse({ body: forms }));
                saveSubject.complete();
                // THEN
                expect(formsService.create).toHaveBeenCalledWith(forms);
                expect(comp.isSaving).toEqual(false);
                expect(comp.previousState).toHaveBeenCalled();
            });
            it('Should set isSaving to false on error', () => {
                // GIVEN
                const saveSubject = new rxjs_1.Subject();
                const forms = { id: 123 };
                spyOn(formsService, 'update').and.returnValue(saveSubject);
                spyOn(comp, 'previousState');
                activatedRoute.data = rxjs_1.of({ forms });
                comp.ngOnInit();
                // WHEN
                comp.save();
                expect(comp.isSaving).toEqual(true);
                saveSubject.error('This is an error!');
                // THEN
                expect(formsService.update).toHaveBeenCalledWith(forms);
                expect(comp.isSaving).toEqual(false);
                expect(comp.previousState).not.toHaveBeenCalled();
            });
        });
        describe('Tracking relationships identifiers', () => {
            describe('trackUserById', () => {
                it('Should return tracked User primary key', () => {
                    const entity = { id: 123 };
                    const trackResult = comp.trackUserById(0, entity);
                    expect(trackResult).toEqual(entity.id);
                });
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUva2FydGhpay9jeW5hcHNlVGVjaC9zcmMvbWFpbi93ZWJhcHAvYXBwL2VudGl0aWVzL2Zvcm1zL3VwZGF0ZS9mb3Jtcy11cGRhdGUuY29tcG9uZW50LnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7QUFFN0IsbURBQWtFO0FBQ2xFLCtDQUFvRDtBQUNwRCwwREFBdUU7QUFDdkUsMENBQTZDO0FBQzdDLDRDQUFpRDtBQUNqRCwrQkFBbUM7QUFFbkMsNERBQXdEO0FBQ3hELGdEQUErQztBQUcvQyxpRUFBNkQ7QUFFN0QscUVBQWdFO0FBRWhFLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7SUFDL0IsUUFBUSxDQUFDLG1DQUFtQyxFQUFFLEdBQUcsRUFBRTtRQUNqRCxJQUFJLElBQTBCLENBQUM7UUFDL0IsSUFBSSxPQUErQyxDQUFDO1FBQ3BELElBQUksY0FBOEIsQ0FBQztRQUNuQyxJQUFJLFlBQTBCLENBQUM7UUFDL0IsSUFBSSxXQUF3QixDQUFDO1FBRTdCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDZCxpQkFBTyxDQUFDLHNCQUFzQixDQUFDO2dCQUM3QixPQUFPLEVBQUUsQ0FBQyxpQ0FBdUIsQ0FBQztnQkFDbEMsWUFBWSxFQUFFLENBQUMsNkNBQW9CLENBQUM7Z0JBQ3BDLFNBQVMsRUFBRSxDQUFDLG1CQUFXLEVBQUUsdUJBQWMsQ0FBQzthQUN6QyxDQUFDO2lCQUNDLGdCQUFnQixDQUFDLDZDQUFvQixFQUFFLEVBQUUsQ0FBQztpQkFDMUMsaUJBQWlCLEVBQUUsQ0FBQztZQUV2QixPQUFPLEdBQUcsaUJBQU8sQ0FBQyxlQUFlLENBQUMsNkNBQW9CLENBQUMsQ0FBQztZQUN4RCxjQUFjLEdBQUcsaUJBQU8sQ0FBQyxNQUFNLENBQUMsdUJBQWMsQ0FBQyxDQUFDO1lBQ2hELFlBQVksR0FBRyxpQkFBTyxDQUFDLE1BQU0sQ0FBQyw0QkFBWSxDQUFDLENBQUM7WUFDNUMsV0FBVyxHQUFHLGlCQUFPLENBQUMsTUFBTSxDQUFDLDBCQUFXLENBQUMsQ0FBQztZQUUxQyxJQUFJLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDO1FBQ25DLENBQUMsQ0FBQyxDQUFDO1FBRUgsUUFBUSxDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUU7WUFDeEIsRUFBRSxDQUFDLDhDQUE4QyxFQUFFLEdBQUcsRUFBRTtnQkFDdEQsTUFBTSxLQUFLLEdBQVcsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLENBQUM7Z0JBQ2xDLE1BQU0sSUFBSSxHQUFVLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDO2dCQUNsQyxLQUFLLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztnQkFFbEIsTUFBTSxjQUFjLEdBQVksQ0FBQyxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO2dCQUNoRCxLQUFLLENBQUMsV0FBVyxFQUFFLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsU0FBRSxDQUFDLElBQUksbUJBQVksQ0FBQyxFQUFFLElBQUksRUFBRSxjQUFjLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDNUYsTUFBTSxlQUFlLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDL0IsTUFBTSxrQkFBa0IsR0FBWSxDQUFDLEdBQUcsZUFBZSxFQUFFLEdBQUcsY0FBYyxDQUFDLENBQUM7Z0JBQzVFLEtBQUssQ0FBQyxXQUFXLEVBQUUsOEJBQThCLENBQUMsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLGtCQUFrQixDQUFDLENBQUM7Z0JBRXZGLGNBQWMsQ0FBQyxJQUFJLEdBQUcsU0FBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztnQkFDcEMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUVoQixNQUFNLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUM7Z0JBQzdDLE1BQU0sQ0FBQyxXQUFXLENBQUMsNEJBQTRCLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxjQUFjLEVBQUUsR0FBRyxlQUFlLENBQUMsQ0FBQztnQkFDMUcsTUFBTSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1lBQ2pFLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLHdCQUF3QixFQUFFLEdBQUcsRUFBRTtnQkFDaEMsTUFBTSxLQUFLLEdBQVcsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLENBQUM7Z0JBQ2xDLE1BQU0sSUFBSSxHQUFVLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDO2dCQUNsQyxLQUFLLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztnQkFFbEIsY0FBYyxDQUFDLElBQUksR0FBRyxTQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO2dCQUNwQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7Z0JBRWhCLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDcEUsTUFBTSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNyRCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsUUFBUSxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUU7WUFDcEIsRUFBRSxDQUFDLHdEQUF3RCxFQUFFLEdBQUcsRUFBRTtnQkFDaEUsUUFBUTtnQkFDUixNQUFNLFdBQVcsR0FBRyxJQUFJLGNBQU8sRUFBRSxDQUFDO2dCQUNsQyxNQUFNLEtBQUssR0FBRyxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsQ0FBQztnQkFDMUIsS0FBSyxDQUFDLFlBQVksRUFBRSxRQUFRLENBQUMsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDO2dCQUMzRCxLQUFLLENBQUMsSUFBSSxFQUFFLGVBQWUsQ0FBQyxDQUFDO2dCQUM3QixjQUFjLENBQUMsSUFBSSxHQUFHLFNBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7Z0JBQ3BDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztnQkFFaEIsT0FBTztnQkFDUCxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ1osTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3BDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxtQkFBWSxDQUFDLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDcEQsV0FBVyxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUV2QixPQUFPO2dCQUNQLE1BQU0sQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztnQkFDOUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDeEQsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDdkMsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsbURBQW1ELEVBQUUsR0FBRyxFQUFFO2dCQUMzRCxRQUFRO2dCQUNSLE1BQU0sV0FBVyxHQUFHLElBQUksY0FBTyxFQUFFLENBQUM7Z0JBQ2xDLE1BQU0sS0FBSyxHQUFHLElBQUksbUJBQUssRUFBRSxDQUFDO2dCQUMxQixLQUFLLENBQUMsWUFBWSxFQUFFLFFBQVEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBQzNELEtBQUssQ0FBQyxJQUFJLEVBQUUsZUFBZSxDQUFDLENBQUM7Z0JBQzdCLGNBQWMsQ0FBQyxJQUFJLEdBQUcsU0FBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztnQkFDcEMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUVoQixPQUFPO2dCQUNQLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDWixNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDcEMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLG1CQUFZLENBQUMsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUNwRCxXQUFXLENBQUMsUUFBUSxFQUFFLENBQUM7Z0JBRXZCLE9BQU87Z0JBQ1AsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDeEQsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3JDLE1BQU0sQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztZQUNoRCxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyx1Q0FBdUMsRUFBRSxHQUFHLEVBQUU7Z0JBQy9DLFFBQVE7Z0JBQ1IsTUFBTSxXQUFXLEdBQUcsSUFBSSxjQUFPLEVBQUUsQ0FBQztnQkFDbEMsTUFBTSxLQUFLLEdBQUcsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLENBQUM7Z0JBQzFCLEtBQUssQ0FBQyxZQUFZLEVBQUUsUUFBUSxDQUFDLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsQ0FBQztnQkFDM0QsS0FBSyxDQUFDLElBQUksRUFBRSxlQUFlLENBQUMsQ0FBQztnQkFDN0IsY0FBYyxDQUFDLElBQUksR0FBRyxTQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO2dCQUNwQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7Z0JBRWhCLE9BQU87Z0JBQ1AsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUNaLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNwQyxXQUFXLENBQUMsS0FBSyxDQUFDLG1CQUFtQixDQUFDLENBQUM7Z0JBRXZDLE9BQU87Z0JBQ1AsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDeEQsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3JDLE1BQU0sQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDcEQsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyxvQ0FBb0MsRUFBRSxHQUFHLEVBQUU7WUFDbEQsUUFBUSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7Z0JBQzdCLEVBQUUsQ0FBQyx3Q0FBd0MsRUFBRSxHQUFHLEVBQUU7b0JBQ2hELE1BQU0sTUFBTSxHQUFHLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDO29CQUMzQixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztvQkFDbEQsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQ3pDLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUva2FydGhpay9jeW5hcHNlVGVjaC9zcmMvbWFpbi93ZWJhcHAvYXBwL2VudGl0aWVzL2Zvcm1zL3VwZGF0ZS9mb3Jtcy11cGRhdGUuY29tcG9uZW50LnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiamVzdC5tb2NrKCdAYW5ndWxhci9yb3V0ZXInKTtcblxuaW1wb3J0IHsgQ29tcG9uZW50Rml4dHVyZSwgVGVzdEJlZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUvdGVzdGluZyc7XG5pbXBvcnQgeyBIdHRwUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50VGVzdGluZ01vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwL3Rlc3RpbmcnO1xuaW1wb3J0IHsgRm9ybUJ1aWxkZXIgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBvZiwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBGb3Jtc1NlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlL2Zvcm1zLnNlcnZpY2UnO1xuaW1wb3J0IHsgSUZvcm1zLCBGb3JtcyB9IGZyb20gJy4uL2Zvcm1zLm1vZGVsJztcblxuaW1wb3J0IHsgSVVzZXIgfSBmcm9tICdhcHAvZW50aXRpZXMvdXNlci91c2VyLm1vZGVsJztcbmltcG9ydCB7IFVzZXJTZXJ2aWNlIH0gZnJvbSAnYXBwL2VudGl0aWVzL3VzZXIvdXNlci5zZXJ2aWNlJztcblxuaW1wb3J0IHsgRm9ybXNVcGRhdGVDb21wb25lbnQgfSBmcm9tICcuL2Zvcm1zLXVwZGF0ZS5jb21wb25lbnQnO1xuXG5kZXNjcmliZSgnQ29tcG9uZW50IFRlc3RzJywgKCkgPT4ge1xuICBkZXNjcmliZSgnRm9ybXMgTWFuYWdlbWVudCBVcGRhdGUgQ29tcG9uZW50JywgKCkgPT4ge1xuICAgIGxldCBjb21wOiBGb3Jtc1VwZGF0ZUNvbXBvbmVudDtcbiAgICBsZXQgZml4dHVyZTogQ29tcG9uZW50Rml4dHVyZTxGb3Jtc1VwZGF0ZUNvbXBvbmVudD47XG4gICAgbGV0IGFjdGl2YXRlZFJvdXRlOiBBY3RpdmF0ZWRSb3V0ZTtcbiAgICBsZXQgZm9ybXNTZXJ2aWNlOiBGb3Jtc1NlcnZpY2U7XG4gICAgbGV0IHVzZXJTZXJ2aWNlOiBVc2VyU2VydmljZTtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgVGVzdEJlZC5jb25maWd1cmVUZXN0aW5nTW9kdWxlKHtcbiAgICAgICAgaW1wb3J0czogW0h0dHBDbGllbnRUZXN0aW5nTW9kdWxlXSxcbiAgICAgICAgZGVjbGFyYXRpb25zOiBbRm9ybXNVcGRhdGVDb21wb25lbnRdLFxuICAgICAgICBwcm92aWRlcnM6IFtGb3JtQnVpbGRlciwgQWN0aXZhdGVkUm91dGVdLFxuICAgICAgfSlcbiAgICAgICAgLm92ZXJyaWRlVGVtcGxhdGUoRm9ybXNVcGRhdGVDb21wb25lbnQsICcnKVxuICAgICAgICAuY29tcGlsZUNvbXBvbmVudHMoKTtcblxuICAgICAgZml4dHVyZSA9IFRlc3RCZWQuY3JlYXRlQ29tcG9uZW50KEZvcm1zVXBkYXRlQ29tcG9uZW50KTtcbiAgICAgIGFjdGl2YXRlZFJvdXRlID0gVGVzdEJlZC5pbmplY3QoQWN0aXZhdGVkUm91dGUpO1xuICAgICAgZm9ybXNTZXJ2aWNlID0gVGVzdEJlZC5pbmplY3QoRm9ybXNTZXJ2aWNlKTtcbiAgICAgIHVzZXJTZXJ2aWNlID0gVGVzdEJlZC5pbmplY3QoVXNlclNlcnZpY2UpO1xuXG4gICAgICBjb21wID0gZml4dHVyZS5jb21wb25lbnRJbnN0YW5jZTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCduZ09uSW5pdCcsICgpID0+IHtcbiAgICAgIGl0KCdTaG91bGQgY2FsbCBVc2VyIHF1ZXJ5IGFuZCBhZGQgbWlzc2luZyB2YWx1ZScsICgpID0+IHtcbiAgICAgICAgY29uc3QgZm9ybXM6IElGb3JtcyA9IHsgaWQ6IDQ1NiB9O1xuICAgICAgICBjb25zdCB1c2VyOiBJVXNlciA9IHsgaWQ6IDczOTE0IH07XG4gICAgICAgIGZvcm1zLnVzZXIgPSB1c2VyO1xuXG4gICAgICAgIGNvbnN0IHVzZXJDb2xsZWN0aW9uOiBJVXNlcltdID0gW3sgaWQ6IDg0OTMzIH1dO1xuICAgICAgICBzcHlPbih1c2VyU2VydmljZSwgJ3F1ZXJ5JykuYW5kLnJldHVyblZhbHVlKG9mKG5ldyBIdHRwUmVzcG9uc2UoeyBib2R5OiB1c2VyQ29sbGVjdGlvbiB9KSkpO1xuICAgICAgICBjb25zdCBhZGRpdGlvbmFsVXNlcnMgPSBbdXNlcl07XG4gICAgICAgIGNvbnN0IGV4cGVjdGVkQ29sbGVjdGlvbjogSVVzZXJbXSA9IFsuLi5hZGRpdGlvbmFsVXNlcnMsIC4uLnVzZXJDb2xsZWN0aW9uXTtcbiAgICAgICAgc3B5T24odXNlclNlcnZpY2UsICdhZGRVc2VyVG9Db2xsZWN0aW9uSWZNaXNzaW5nJykuYW5kLnJldHVyblZhbHVlKGV4cGVjdGVkQ29sbGVjdGlvbik7XG5cbiAgICAgICAgYWN0aXZhdGVkUm91dGUuZGF0YSA9IG9mKHsgZm9ybXMgfSk7XG4gICAgICAgIGNvbXAubmdPbkluaXQoKTtcblxuICAgICAgICBleHBlY3QodXNlclNlcnZpY2UucXVlcnkpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgZXhwZWN0KHVzZXJTZXJ2aWNlLmFkZFVzZXJUb0NvbGxlY3Rpb25JZk1pc3NpbmcpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHVzZXJDb2xsZWN0aW9uLCAuLi5hZGRpdGlvbmFsVXNlcnMpO1xuICAgICAgICBleHBlY3QoY29tcC51c2Vyc1NoYXJlZENvbGxlY3Rpb24pLnRvRXF1YWwoZXhwZWN0ZWRDb2xsZWN0aW9uKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnU2hvdWxkIHVwZGF0ZSBlZGl0Rm9ybScsICgpID0+IHtcbiAgICAgICAgY29uc3QgZm9ybXM6IElGb3JtcyA9IHsgaWQ6IDQ1NiB9O1xuICAgICAgICBjb25zdCB1c2VyOiBJVXNlciA9IHsgaWQ6IDE1ODEyIH07XG4gICAgICAgIGZvcm1zLnVzZXIgPSB1c2VyO1xuXG4gICAgICAgIGFjdGl2YXRlZFJvdXRlLmRhdGEgPSBvZih7IGZvcm1zIH0pO1xuICAgICAgICBjb21wLm5nT25Jbml0KCk7XG5cbiAgICAgICAgZXhwZWN0KGNvbXAuZWRpdEZvcm0udmFsdWUpLnRvRXF1YWwoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoZm9ybXMpKTtcbiAgICAgICAgZXhwZWN0KGNvbXAudXNlcnNTaGFyZWRDb2xsZWN0aW9uKS50b0NvbnRhaW4odXNlcik7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdzYXZlJywgKCkgPT4ge1xuICAgICAgaXQoJ1Nob3VsZCBjYWxsIHVwZGF0ZSBzZXJ2aWNlIG9uIHNhdmUgZm9yIGV4aXN0aW5nIGVudGl0eScsICgpID0+IHtcbiAgICAgICAgLy8gR0lWRU5cbiAgICAgICAgY29uc3Qgc2F2ZVN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xuICAgICAgICBjb25zdCBmb3JtcyA9IHsgaWQ6IDEyMyB9O1xuICAgICAgICBzcHlPbihmb3Jtc1NlcnZpY2UsICd1cGRhdGUnKS5hbmQucmV0dXJuVmFsdWUoc2F2ZVN1YmplY3QpO1xuICAgICAgICBzcHlPbihjb21wLCAncHJldmlvdXNTdGF0ZScpO1xuICAgICAgICBhY3RpdmF0ZWRSb3V0ZS5kYXRhID0gb2YoeyBmb3JtcyB9KTtcbiAgICAgICAgY29tcC5uZ09uSW5pdCgpO1xuXG4gICAgICAgIC8vIFdIRU5cbiAgICAgICAgY29tcC5zYXZlKCk7XG4gICAgICAgIGV4cGVjdChjb21wLmlzU2F2aW5nKS50b0VxdWFsKHRydWUpO1xuICAgICAgICBzYXZlU3ViamVjdC5uZXh0KG5ldyBIdHRwUmVzcG9uc2UoeyBib2R5OiBmb3JtcyB9KSk7XG4gICAgICAgIHNhdmVTdWJqZWN0LmNvbXBsZXRlKCk7XG5cbiAgICAgICAgLy8gVEhFTlxuICAgICAgICBleHBlY3QoY29tcC5wcmV2aW91c1N0YXRlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgIGV4cGVjdChmb3Jtc1NlcnZpY2UudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChmb3Jtcyk7XG4gICAgICAgIGV4cGVjdChjb21wLmlzU2F2aW5nKS50b0VxdWFsKGZhbHNlKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnU2hvdWxkIGNhbGwgY3JlYXRlIHNlcnZpY2Ugb24gc2F2ZSBmb3IgbmV3IGVudGl0eScsICgpID0+IHtcbiAgICAgICAgLy8gR0lWRU5cbiAgICAgICAgY29uc3Qgc2F2ZVN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xuICAgICAgICBjb25zdCBmb3JtcyA9IG5ldyBGb3JtcygpO1xuICAgICAgICBzcHlPbihmb3Jtc1NlcnZpY2UsICdjcmVhdGUnKS5hbmQucmV0dXJuVmFsdWUoc2F2ZVN1YmplY3QpO1xuICAgICAgICBzcHlPbihjb21wLCAncHJldmlvdXNTdGF0ZScpO1xuICAgICAgICBhY3RpdmF0ZWRSb3V0ZS5kYXRhID0gb2YoeyBmb3JtcyB9KTtcbiAgICAgICAgY29tcC5uZ09uSW5pdCgpO1xuXG4gICAgICAgIC8vIFdIRU5cbiAgICAgICAgY29tcC5zYXZlKCk7XG4gICAgICAgIGV4cGVjdChjb21wLmlzU2F2aW5nKS50b0VxdWFsKHRydWUpO1xuICAgICAgICBzYXZlU3ViamVjdC5uZXh0KG5ldyBIdHRwUmVzcG9uc2UoeyBib2R5OiBmb3JtcyB9KSk7XG4gICAgICAgIHNhdmVTdWJqZWN0LmNvbXBsZXRlKCk7XG5cbiAgICAgICAgLy8gVEhFTlxuICAgICAgICBleHBlY3QoZm9ybXNTZXJ2aWNlLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZm9ybXMpO1xuICAgICAgICBleHBlY3QoY29tcC5pc1NhdmluZykudG9FcXVhbChmYWxzZSk7XG4gICAgICAgIGV4cGVjdChjb21wLnByZXZpb3VzU3RhdGUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnU2hvdWxkIHNldCBpc1NhdmluZyB0byBmYWxzZSBvbiBlcnJvcicsICgpID0+IHtcbiAgICAgICAgLy8gR0lWRU5cbiAgICAgICAgY29uc3Qgc2F2ZVN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xuICAgICAgICBjb25zdCBmb3JtcyA9IHsgaWQ6IDEyMyB9O1xuICAgICAgICBzcHlPbihmb3Jtc1NlcnZpY2UsICd1cGRhdGUnKS5hbmQucmV0dXJuVmFsdWUoc2F2ZVN1YmplY3QpO1xuICAgICAgICBzcHlPbihjb21wLCAncHJldmlvdXNTdGF0ZScpO1xuICAgICAgICBhY3RpdmF0ZWRSb3V0ZS5kYXRhID0gb2YoeyBmb3JtcyB9KTtcbiAgICAgICAgY29tcC5uZ09uSW5pdCgpO1xuXG4gICAgICAgIC8vIFdIRU5cbiAgICAgICAgY29tcC5zYXZlKCk7XG4gICAgICAgIGV4cGVjdChjb21wLmlzU2F2aW5nKS50b0VxdWFsKHRydWUpO1xuICAgICAgICBzYXZlU3ViamVjdC5lcnJvcignVGhpcyBpcyBhbiBlcnJvciEnKTtcblxuICAgICAgICAvLyBUSEVOXG4gICAgICAgIGV4cGVjdChmb3Jtc1NlcnZpY2UudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChmb3Jtcyk7XG4gICAgICAgIGV4cGVjdChjb21wLmlzU2F2aW5nKS50b0VxdWFsKGZhbHNlKTtcbiAgICAgICAgZXhwZWN0KGNvbXAucHJldmlvdXNTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1RyYWNraW5nIHJlbGF0aW9uc2hpcHMgaWRlbnRpZmllcnMnLCAoKSA9PiB7XG4gICAgICBkZXNjcmliZSgndHJhY2tVc2VyQnlJZCcsICgpID0+IHtcbiAgICAgICAgaXQoJ1Nob3VsZCByZXR1cm4gdHJhY2tlZCBVc2VyIHByaW1hcnkga2V5JywgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGVudGl0eSA9IHsgaWQ6IDEyMyB9O1xuICAgICAgICAgIGNvbnN0IHRyYWNrUmVzdWx0ID0gY29tcC50cmFja1VzZXJCeUlkKDAsIGVudGl0eSk7XG4gICAgICAgICAgZXhwZWN0KHRyYWNrUmVzdWx0KS50b0VxdWFsKGVudGl0eS5pZCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=